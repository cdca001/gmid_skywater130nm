# gmid_skywater130nm

# Setup Ubuntu 24.04 LTS

Used this method to install: https://philipwig.com/tutorials/installing-skywater/#method-1-python-script-install
Changes from the steps provided:
Install Anaconda3/miniconda
make sure to activate the conda environment, use conda activate skywater
update the tool versions: python setup/skywater.py update -y
Failing install of ngspice -> change setup/scripts/ngspice/install.sh. Change libfftw3-3 to libfftw3-bin.
To find package, use apt search fftw3
add build-essential to install.sh to solve g++ command not found issue.
To solve skywater failing install, check err.txt and run the conda commands to accept terms of service.
Edit setup/scripts/skywater/install.sh -> comment out git SC HD and SC HVL -> this is logic library
Comment out make timing -> only for asic flow
All tools will be installed in ~/tools/
Edit setup/scripts/open_pdks/install.sh -> disable other variants of skywater pdk, only install variant A and disable GF180
If variants is set to ALL (A and B), install will exit unexpectedly.
Edit setup/scripts/open_pdks/install.sh. Remove tha paths "$1/skywater-pdk/" in the enable options in configure. this will force open_pdk to download fresh copy of skywater PDK.
This means we can skip step in cloning skywater pdk in previous step????
PDK is installed here: /usr/local/share/pdk/
Another great resource for installation of tools for skywater: https://github.com/HRITAM-MITRA/Installation-of-open-source-analog-design-tools-with-sky130-PDK
http://opencircuitdesign.com/open_pdks/

# AICEX
Too complicated for my use case. Uses docker and downloads its own models from skywater. I want something that can use what I already have..

# gmid (medwatt) python
after clone, install requirements numpy, scipy, matplotlib using pip.
cd to gmid git clone, "pip install ." to install package into python environment.
Devices: https://skywater-pdk.readthedocs.io/en/main/rules/device-details.html

# Issue
Modelname invalid. After install retries, the issue is still there. The real solution is to change the W and L of transistor. The default unit in skywater PDK is micrometers. Meaning, you do not need to use 1e-6 and instead just use 1 to indicate 1 micron.
Solution: use W=10, L=0.15 for transistor with w=10um and l=150nm

# Update 09-09
Was able to generate tables using the gmid scripts. Created sky130_lib.py to overwrite some class functions. This is necessary because skywater devices are defined as subcircuits.
sudo apt install snapd
sudo snap install code --classic

Use jupyter notebook from sample video.

# Issue
Issue with numpy version 2.0. It cannot read data compiled using old numpy. I am not sure why the data generated by ngspice is not compatible with numpy 2. The whole conda environment uses numpy 2.
Solution: downgrade conda env numpy version "pip install numpy==1.26.4"

# Update 09-10
# Issue
Cannot plot. missing gm parameter issue.
Cause: vdssat parameter cannot be found in the model of sky130. 
Solution: Commented out saving of vdssat.
Issue still exists, no data for gm and other parameters.
Solution:
```
    def setup_dc_simulation(self, sweep):
            symbol = self.mos_spice_symbols[1]
            model = sweep.mos_type
            # removed vdssat (Sen)
            self.parameter_table = {
                "id":     ["save i(vds)",             "i(i_vds)"],
                "weff":   [f"save @m.{symbol}.m{model}[weff]",   f"v(@m.{symbol}.m{model}[weff])"],
                "vth":    [f"save @m.{symbol}.m{model}[vth]",    f"v(@m.{symbol}.m{model}[vth])"],
                "vdsat":  [f"save @m.{symbol}.m{model}[vdsat]",  f"v(@m.{symbol}.m{model}[vdsst])"],
                "gm":     [f"save @m.{symbol}.m{model}[gm]",     f"@m.{symbol}.m{model}[gm]"],
                "gmbs":   [f"save @m.{symbol}.m{model}[gmbs]",   f"@m.{symbol}.m{model}[gmbs]"],
                "gds":    [f"save @m.{symbol}.m{model}[gds]",    f"@m.{symbol}.m{model}[gds]"],
                "cgg":    [f"save @m.{symbol}.m{model}[cgg]",    f"@m.{symbol}.m{model}[cgg]"],
                "cgs":    [f"save @m.{symbol}.m{model}[cgs]",    f"@m.{symbol}.m{model}[cgs]"],
                "cbg":    [f"save @m.{symbol}.m{model}[cbg]",    f"@m.{symbol}.m{model}[cbg]"],
                "cgd":    [f"save @m.{symbol}.m{model}[cgd]",    f"@m.{symbol}.m{model}[cgd]"],
                "cdd":    [f"save @m.{symbol}.m{model}[cdd]",    f"@m.{symbol}.m{model}[cdd]"],
            }
```

# Update 09-11
# Issue
missing vdsat_expression in numpy data. 
Cause: typo error in setup_dc_simulation function. See vdsat line for saving parameter. the error is in vdsst.

# NEXT
1. Install VSCODE with jupyter - DONE
2. Create jupyter notebook to create a common source amplifier using gmid methodology
3. Install copilot in vscode, let copilot design a common source amplifier